{% extends "base.html" %}

{% block title %}Matches{% endblock %}

{% block content %}
<div class="space-y-6">
    <div>
        <h2 class="text-3xl font-bold text-primary-text-dark">Job-Consultant Matches</h2>
        <p class="mt-2 text-secondary-text-dark">AI-powered matching between jobs and consultants</p>
    </div>

    <!-- Filters -->
    <div class="bg-primary-dark p-4 rounded-lg shadow-lg">
        <form method="get" action="/consultant/matches" class="flex flex-wrap items-end gap-4">
            <div>
                <label for="min_score" class="block text-sm font-medium text-secondary-text-dark">Minimum Score</label>
                <select id="min_score" name="min_score" class="mt-1 block w-full pl-3 pr-10 py-2 text-base bg-secondary-dark border-gray-600 focus:outline-none focus:ring-accent-dark focus:border-accent-dark sm:text-sm rounded-md text-primary-text-dark">
                    <option value="0.5" {% if min_score == 0.5 %}selected{% endif %}>50%</option>
                    <option value="0.6" {% if min_score == 0.6 %}selected{% endif %}>60%</option>
                    <option value="0.7" {% if min_score == 0.7 %}selected{% endif %}>70%</option>
                    <option value="0.8" {% if min_score == 0.8 %}selected{% endif %}>80%</option>
                    <option value="0.9" {% if min_score == 0.9 %}selected{% endif %}>90%</option>
                </select>
            </div>
            <button type="submit" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-accent-dark hover:bg-accent-dark/80 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-accent-dark">
                Apply Filters
            </button>
        </form>
    </div>

    <!-- Matches List -->
    <div class="bg-primary-dark shadow-lg rounded-lg overflow-hidden">
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-700">
                <thead class="bg-secondary-dark">
                    <tr>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-secondary-text-dark uppercase tracking-wider">Score</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-secondary-text-dark uppercase tracking-wider">Job</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-secondary-text-dark uppercase tracking-wider">Consultant</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-secondary-text-dark uppercase tracking-wider">Match Details</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-secondary-text-dark uppercase tracking-wider">Actions</th>
                    </tr>
                </thead>
                <tbody class="bg-primary-dark divide-y divide-gray-700">
                    {% for match in matches %}
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="flex items-center">
                                <div class="h-10 w-10 rounded-full flex items-center justify-center text-sm font-medium 
                                            {% if match.score >= 0.9 %}bg-green-900/50 text-green-300
                                            {% elif match.score >= 0.8 %}bg-blue-900/50 text-blue-300
                                            {% elif match.score >= 0.7 %}bg-yellow-900/50 text-yellow-300
                                            {% elif match.score >= 0.6 %}bg-orange-900/50 text-orange-300
                                            {% else %}bg-red-900/50 text-red-300{% endif %}">
                                    {{ (match.score * 100)|round|int }}%
                                </div>
                            </div>
                        </td>
                        <td class="px-6 py-4">
                            <div class="text-sm font-medium text-primary-text-dark">{{ match.job_title }}</div>
                            <div class="text-sm text-secondary-text-dark">{{ match.job_company or 'Unknown Company' }} - {{ match.job_location }}</div>
                        </td>
                        <td class="px-6 py-4">
                            <div class="text-sm font-medium text-primary-text-dark">{{ match.consultant_name }}</div>
                            <div class="text-sm text-secondary-text-dark">{{ match.consultant_role }} - {{ match.consultant_seniority }}</div>
                        </td>
                        <td class="px-6 py-4 text-sm text-secondary-text-dark">
                            {% if match.reasoning %}
                            <button onclick="openModal('reasoning-modal-{{ match.match_id }}')" class="text-accent-dark hover:text-accent-dark/80">View Details</button>
                            {% else %}
                            No details available
                            {% endif %}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                            <button class="text-green-400 hover:text-green-300 mr-3">Contact</button>
                            <button class="text-blue-400 hover:text-blue-300">Export</button>
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="5" class="px-6 py-4 text-center text-secondary-text-dark">
                            {% if job_id or consultant_id %}
                            No matches found. Try lowering the minimum score or generate new matches.
                            {% else %}
                            No matches to display. Select a job or consultant to view matches, or generate matches for jobs.
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Reasoning Modals -->
{% for match in matches %}
{% if match.reasoning %}
<div id="reasoning-modal-{{ match.match_id }}" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 hidden">
    <div class="bg-primary-dark rounded-lg shadow-xl p-6 w-full max-w-2xl m-4">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-lg font-bold text-primary-text-dark">Match Analysis</h3>
            <button onclick="closeModal('reasoning-modal-{{ match.match_id }}')" class="text-secondary-text-dark hover:text-primary-text-dark">&times;</button>
        </div>
        <div class="mb-4">
            <h4 class="text-sm font-medium text-primary-text-dark mb-2">Job: {{ match.job_title }}</h4>
            <h4 class="text-sm font-medium text-primary-text-dark mb-2">Consultant: {{ match.consultant_name }}</h4>
            <h4 class="text-sm font-medium text-primary-text-dark mb-2">Score: {{ (match.score * 100)|round|int }}%</h4>
        </div>
        <div class="mb-4">
            <h4 class="text-sm font-medium text-primary-text-dark mb-2">Reasoning</h4>
            <div class="text-sm text-secondary-text-dark whitespace-pre-line bg-secondary-dark p-4 rounded-md">{{ match.reasoning }}</div>
        </div>
        <div class="flex justify-end space-x-3 mt-6">
            <button onclick="closeModal('reasoning-modal-{{ match.match_id }}')" class="px-4 py-2 bg-secondary-dark text-primary-text-dark text-sm rounded-md hover:bg-gray-600">Close</button>
        </div>
    </div>
</div>
{% endif %}
{% endfor %}

{% endblock %}

{% block scripts %}
<script>
function openModal(modalId) {
    document.getElementById(modalId).classList.remove('hidden');
}

function closeModal(modalId) {
    document.getElementById(modalId).classList.add('hidden');
}

window.onclick = function(event) {
    if (event.target.classList.contains('bg-opacity-75')) {
        closeModal(event.target.id);
    }
}
</script>
{% endblock %}
