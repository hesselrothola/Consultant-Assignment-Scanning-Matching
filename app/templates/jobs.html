{% extends "base.html" %}

{% block title %}Jobs{% endblock %}

{% block content %}
<div class="space-y-6">
    <div>
        <h2 class="text-3xl font-bold text-primary-text-dark">Job Assignments</h2>
        <p class="mt-2 text-secondary-text-dark">View and manage consultant assignments from various sources</p>
    </div>

    <!-- Filters -->
    <div class="bg-primary-dark p-4 rounded-lg shadow-lg">
        <form method="get" action="/consultant/jobs" class="flex flex-wrap items-end gap-4">
            <div>
                <label for="source" class="block text-sm font-medium text-secondary-text-dark">Source</label>
                <select id="source" name="source" class="mt-1 block w-full pl-3 pr-10 py-2 text-base bg-secondary-dark border-gray-600 focus:outline-none focus:ring-accent-dark focus:border-accent-dark sm:text-sm rounded-md text-primary-text-dark">
                    <option value="">All Sources</option>
                    <option value="brainville" {% if source == 'brainville' %}selected{% endif %}>Brainville</option>
                    <option value="cinode" {% if source == 'cinode' %}selected{% endif %}>Cinode</option>
                    <option value="linkedin" {% if source == 'linkedin' %}selected{% endif %}>LinkedIn</option>
                    <option value="ework" {% if source == 'ework' %}selected{% endif %}>eWork</option>
                </select>
            </div>
            <div>
                <label for="limit" class="block text-sm font-medium text-secondary-text-dark">Show</label>
                <select id="limit" name="limit" class="mt-1 block w-full pl-3 pr-10 py-2 text-base bg-secondary-dark border-gray-600 focus:outline-none focus:ring-accent-dark focus:border-accent-dark sm:text-sm rounded-md text-primary-text-dark">
                    <option value="20" {% if limit == 20 %}selected{% endif %}>20</option>
                    <option value="50" {% if limit == 50 %}selected{% endif %}>50</option>
                    <option value="100" {% if limit == 100 %}selected{% endif %}>100</option>
                </select>
            </div>
            <button type="submit" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-accent-dark hover:bg-accent-dark/80 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-accent-dark">
                Apply Filters
            </button>
        </form>
    </div>

    <!-- Jobs List -->
    <div class="bg-primary-dark shadow-lg rounded-lg overflow-hidden">
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-700">
                <thead class="bg-secondary-dark">
                    <tr>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-secondary-text-dark uppercase tracking-wider">Title</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-secondary-text-dark uppercase tracking-wider">Company</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-secondary-text-dark uppercase tracking-wider">Location</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-secondary-text-dark uppercase tracking-wider">Skills</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-secondary-text-dark uppercase tracking-wider">Duration</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-secondary-text-dark uppercase tracking-wider">Source</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-secondary-text-dark uppercase tracking-wider">Actions</th>
                    </tr>
                </thead>
                <tbody class="bg-primary-dark divide-y divide-gray-700">
                    {% for job in jobs %}
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm font-medium text-primary-text-dark">{{ job.title }}</div>
                            {% if job.seniority %}
                            <div class="text-sm text-secondary-text-dark">{{ job.seniority }}</div>
                            {% endif %}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-secondary-text-dark">{{ job.company or 'N/A' }}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-secondary-text-dark">
                            {{ job.location_city or 'N/A' }}
                            {% if job.location_country %}, {{ job.location_country }}{% endif %}
                            {% if job.onsite_mode %}<br><span class="text-xs text-gray-400">({{ job.onsite_mode }})</span>{% endif %}
                        </td>
                        <td class="px-6 py-4 text-sm text-secondary-text-dark">
                            <div class="flex flex-wrap gap-1">
                                {% for skill in job.skills[:4] %}
                                <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-accent-dark/20 text-accent-dark">{{ skill }}</span>
                                {% endfor %}
                                {% if job.skills|length > 4 %}
                                <span class="text-xs text-gray-400">+{{ job.skills|length - 4 }} more</span>
                                {% endif %}
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-secondary-text-dark">
                            {{ job.duration or 'N/A' }}
                            {% if job.start_date %}<br><span class="text-xs text-gray-400">Start: {{ job.start_date }}</span>{% endif %}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-secondary-text-dark">
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full 
                                   {% if job.source == 'brainville' %}bg-purple-900/50 text-purple-300
                                   {% elif job.source == 'cinode' %}bg-orange-900/50 text-orange-300
                                   {% elif job.source == 'linkedin' %}bg-blue-900/50 text-blue-300
                                   {% else %}bg-gray-700 text-gray-300{% endif %}">
                                {{ job.source|title }}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                            <a href="/consultant/matches?job_id={{ job.job_id }}" class="text-accent-dark hover:text-accent-dark/80 mr-3">View Matches</a>
                            <button type="button" hx-post="/consultant/matches/generate/{{ job.job_id }}" hx-target="#match-result-{{ job.job_id }}" class="text-green-400 hover:text-green-300 mr-3">Generate Matches</button>
                            {% if job.url %}
                            <a href="{{ job.url }}" target="_blank" class="text-secondary-text-dark hover:text-primary-text-dark">
                                <i class="fas fa-external-link-alt"></i>
                            </a>
                            {% endif %}
                        </td>
                    </tr>
                    <tr id="match-result-{{ job.job_id }}"><td colspan="7"></td></tr>
                    {% else %}
                    <tr>
                        <td colspan="7" class="px-6 py-4 text-center text-secondary-text-dark">
                            No jobs found. Try adjusting your filters or run a scraper to get new jobs.
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}
